# [실습 6 : 22 ~ 23p]

# 8.2 뷰

## 8.2.1 뷰 개념

* SELECT를 통해 조회한 결과를 테이블 형태로 볼 수 있도록 생성한 개체
* VIEW 생성

```SQL
-- 테이블 userTBL
-- 컬럼 : userID, name, addr 컬럼 조회
-- 조건 : addr='서울'
USE SQLDB;
CREATE VIEW v_userTBL
AS
SELECT userID, name, addr
 FROM userTBL
WHERE addr='서울';
```



## 8.2.2 뷰의 장점

- 보안에 도움이 됨
- 복잡한 쿼리 단순화

```SQL
-- 테이블 userTBL, buyTBL
-- view명 : v_userbuyTBL
-- 컬럼 : userID, name, addr, b.prodName, mobile1, mobile2 컬럼 조회
-- 조건 : addr='서울'
CREATE VIEW v_userbuyTBL
AS
SELECT a.userID, a.name, b.prodName, a.addr, concat(a.mobile1, a.mobile2) mobile
  FROM userTBL a
	INNER JOIN buyTBL b
	ON a.userID = b.userID;
```



### [실습] 뷰 활용 (p345 ~ 351)

### 1) view 생성 및 삭제

```SQL
-- 뷰 생성 : v_userbuyTBL
CREATE VIEW v_userbuyTBL
AS
SELECT U.userid AS 'USER ID', U.name AS 'USER NAME', B.prodName AS 'PRODUCT NAME',
	U.addr, CONCAT(U.mobile1, U.mobile2) AS 'MOBILE PHONE'
  FROM userTBL U
INNER JOIN buyTBL B
ON U.userid = B.userid;

-- 뷰 확인 : v_userbuyTBL
SELECT `USER ID`, `USER NAME` FROM v_userbuyTBL;

-- 뷰 삭제 : v_userbuyTBL
DROP VIEW v_userbuyTBL;
```



### 2) view 데이타 변경

```SQL
-- view 생성 및 수정
CREATE OR REPLACE VIEW v_userTBL
AS
SELECT userid, name, birthyear, addr FROM userTBL;

-- view 로 데이타 변경
UPDATE v_userTBL SET addr = '부산' WHERE userid = 'JKW';

-- view로 데이타 입력 : 필수필드값이 없으므로 에러 발생 (birthYear 필수)
INSERT INTO v_userTBL(userid, name, birthyear, addr) VALUES('aaa', '김병만', 1993, '충북');

-- view와 테이블 확인
SELECT * FROM v_usertbl;
SELECT * FROM usertbl;
```



## 3) sum view 생성

```SQL
-- SUM VIEW 생성 : v_sum
-- table : buyTBL
-- group by : userID
-- userid, sum(price*amout)
CREATE VIEW v_sum
AS
SELECT userid AS 'userid', SUM(price*amount) AS 'total'
  FROM buyTBL
GROUP BY userid;

SELECT * FROM v_sum;

-- view insert, update 가능여부 확인
SELECT * FROM information_schema.views
 WHERE table_schema='sqldb' AND table_name='v_sum';
```



### 4) 조건절(키)에 따른 view 생성

```SQL
-- 키가 177이상인 뷰 생성
CREATE VIEW v_height177
AS
SELECT * FROM userTBL WHERE height >= 177;

SELECT * FROM v_height177;

-- view에서는 177미만인 데이타가 없으므로 삭제할 데이타 없음
DELETE FROM v_height177 WHERE height < 177;

-- view를 통해서 데이타 입력, 수정, 삭제 지양
```



### 5) view가 참조하는 테이블 삭제

```SQL
-- v_height177 테이블이 참조하고 있는 userTBL 삭제
DROP TABLE userTBL;
SELECT * FROM v_height177;

-- view 상태 확인
CHECK TABLE v_height177;
```