# 8.1 테이블

# [실습 1 : 5 ~ 7p]

## 8.1.1 테이블 만들기

* database 생성

```SQL
DROP DATABASE tableDB;
CREATE DATABASE tableDB;
USE tableDB;
```

* userTbl 생성

```SQL
CREATE TABLE userTbl
( userID    CHAR(8) not null primary key,     -- 사용자 아이디(PK)
  name      VARCHAR(10) NOT NULL,             -- 이름
  birthYear INT NOT NULL,                     -- 출생연도
  addr      CHAR(2) NOT NULL,                 -- 지역(서울, 경기, 경남)
  mobile1   CHAR(3),                          -- 국번
  mobile2   CHAR(8),                          -- 번호2
  height    SMALLINT,                         -- 키
  mDate     DATE                              -- 회원 가입일
);
```

* buyTbl 생성

```SQL
CREATE TABLE buyTbl
( num       INT AUTO_INCREMENT NOT NULL PRIMARY KEY, -- 순번(PK)
  userID    CHAR(8) NOT NULL,                        -- 아이디(FK)
  prodName  CHAR(6) NOT NULL,                        -- 물품명
  groupName CHAR(4),                                 -- 분류
  price     INT NOT NULL,                            -- 단가
  amount    SMALLINT NOT NULL,                       -- 수량
  FOREIGN KEY (userID) REFERENCES userTbl(userID)    -- 외래 키 지정
);
```

* userTbl 데이터 생성

```sql
INSERT INTO usertbl VALUES('LSG', '이승기', 1987, '서울', '011', '11111111', 182, '2008-8-8');
INSERT INTO usertbl VALUES('KBS', '김범수', 1979, '경남', '011', '22222222', 173, '2012-4-4');
INSERT INTO usertbl VALUES('KKH', '김경호', 1971, '전남', '019', '33333333', 177, '2007-7-7');
```

* buyTbl 데이터 생성 (foreign key 규칙에 맞는 데이타만 insert됨)

```SQL
INSERT INTO buytbl VALUES(NULL, 'KBS', '운동화',  NULL,  30,   2);
INSERT INTO buytbl VALUES(NULL, 'KBS', '노트북',  '전자',  1000,   1);
INSERT INTO buytbl VALUES(NULL, 'JYP', '모니터',  '전자',  200,   1);
```

* userTbl 추가 데이터 생성

```SQLINSERT INTO usertbl VALUES('JYP', '조용필', 1950, '경기', '011', '44444444', 166, '2009-4-4');
INSERT INTO usertbl VALUES('JYP', '조용필', 1950, '경기',  '011', '4444444', 166, '2009-4-4');
INSERT INTO usertbl VALUES('SSK', '성시경', 1979, '서울',  NULL,       NULL, 186, '2013-12-12');
INSERT INTO usertbl VALUES('LJB', '임재범', 1963, '서울', '016', '66666666', 182, '2009-9-9');
INSERT INTO usertbl VALUES('YJS', '윤종신', 1969, '경남',  NULL,       NULL, 170, '2005-5-5');
INSERT INTO usertbl VALUES('EJW', '은지원', 1972, '경북', '011', '88888888', 174, '2014-3-3');
INSERT INTO usertbl VALUES('JKW', '조관우', 1965, '경기', '018', '99999999', 172, '2010-10-10');
INSERT INTO usertbl VALUES('BBK', '바비킴', 1973, '서울', '010', '00000000', 176, '2013-5-5');
```

* buyTbl 추가 데이터 생성

```SQL
INSERT INTO buytbl VALUES(NULL, 'JYP', '모니터', '전자',  200,  1);
INSERT INTO buytbl VALUES(NULL, 'BBK', '모니터', '전자',  200,  5);
INSERT INTO buytbl VALUES(NULL, 'KBS', '청바지', '의류',  50,   3);
INSERT INTO buytbl VALUES(NULL, 'BBK', '메모리', '전자',  80,  10);
INSERT INTO buytbl VALUES(NULL, 'SSK', '책',	   '서적',  15,   5);
INSERT INTO buytbl VALUES(NULL, 'EJW', '책',    '서적',  15,   2);
INSERT INTO buytbl VALUES(NULL, 'EJW', '청바지', '의류',  50,   1);
INSERT INTO buytbl VALUES(NULL, 'BBK', '운동화',  NULL,  30,   2);
INSERT INTO buytbl VALUES(NULL, 'EJW', '책',    '서적',  15,   1);
INSERT INTO buytbl VALUES(NULL, 'BBK', '운동화',  NULL,  30,   2);
```



## 8.1.2 제약 조건

* 데이타 무결성을 위한 6가지 제약 조건 : PRIMARY KEY, FOREIGN KEY, UNIQUE, CHECK, DEFAULT, NULL 허용

# [실습 2 : 8 ~ 10p]

### 1) PRIMARY KEY

* 1개의 컬럼을 PRIMARY KEY로 지정

```SQL
use TABLEDB;

-- userTBL 생성
DROP TABLE IF EXISTS buyTBL, userTBL;
CREATE TABLE userTbl
( userID CHAR(8)	NOT NULL PRIMARY KEY, 		
  name VARCHAR(10)	NOT NULL, 		
  birthYear INT 	NOT NULL
);

-- PRIMARY KEY 삭제
ALTER TABLE userTBL
	DROP PRIMARY KEY;

-- PRIMARY KEY 생성
ALTER TABLE userTBL
	ADD PRIMARY KEY (userid);
```

- 2개이상의 컬럼을 PRIMARY KEY로 지정

```SQL
-- prodTBL 생성 : 제품코드 + 제품일련번호(prodCode, prodID)
DROP TABLE IF EXISTS prodTBL;
CREATE TABLE prodTBL
(prodCode	char(3) NOT NULL,
 prodID		char(4) NOT NULL,
 prodDate	Datetime	NOT NULL,
 prodCud		char(10) NULL,
 PRIMARY KEY (prodCode, prodID)
);

-- PRIMARY KEY 삭제
ALTER TABLE prodTBL
	DROP PRIMARY KEY;

-- PRIMARY KEY 생성
ALTER TABLE prodTBL
	ADD PRIMARY KEY (prodCode, prodID);
```

- INDEX 조회

```SQL
-- SHOW INDEX FROM 테이블명
SHOW INDEX FROM prodTBL;
```



# [실습 3 : 11 ~ 13p]

### 2) FOREIGN KEY

* 두 테이블 사이의 관계 선언 -> 무결성 보장

* 외래 키 테이블이 참조하는 기준 테이블의 열 조건

   : Primary Key, Unique 제약조건 설정되어 있는 Key

* 외래 키 생성/삭제

```SQL
-- 테이블 생성 : buyTBL, userTBL
DROP TABLE IF EXISTS buyTBL, userTBL ;
CREATE TABLE userTbl
( userID CHAR(8)		NOT NULL PRIMARY KEY, 		
  name VARCHAR(10)	NOT NULL, 		
  birthYear INT 		NOT NULL
);	

CREATE TABLE buyTbl
( num INT AUTO_INCREMENT NOT NULL PRIMARY KEY,									-- 순번(PK)
  userID CHAR(8) NOT NULL, 			 											-- 아이디(FK)
  prodName CHAR(6) NOT NULL,													-- 물품명
  CONSTRAINT FK_userTBL_buyTBL FOREIGN KEY (userID) REFERENCES userTbl(userID)	-- 외래 키 지정
);

-- 외래 키 삭제
ALTER TABLE buyTBL
	DROP CONSTRAINT FK_userTBL_buyTBL;
	
-- 외래 키 생성	
ALTER TABLE buyTBL
	ADD CONSTRAINT FK_userTBL_buyTBL
	FOREIGN KEY (userID)
	REFERENCES userTBL(userID);
	
-- 인덱스 정보 확인
SHOW INDEX FROM buyTBL;	
```

* 외래키가 있는 경우 기준테이블과 외래키테이블 CUD 예제

```SQL
-- 데이타 추가
INSERT INTO usertbl VALUES('LSG', '이승기', 1987);
INSERT INTO usertbl VALUES('KBS', '김범수', 1979);
INSERT INTO buytbl VALUES(NULL, 'LSG', '운동화');
INSERT INTO buytbl VALUES(NULL, 'LSG', '노트북');

-- 외래키테이블(buyTBL)에 추가, 수정하고자 하는 값이 기준테이블(userTBL)에 없는 경우 - 에러발생
-- 삭제는 자유롭게 가능
INSERT INTO buytbl VALUES(NULL, 'ABC', '노트북');
UPDATE buytbl SET userID='ABC' WHERE userID='LSG';

-- 기준테이블(userTBL)을 수정, 삭제하고자 하는 값이 외래키테이블(buyTBL)에 있는 경우 - 에러발생
-- 추가는 자유롭게 가능
UPDATE usertbl SET userID='ABC' WHERE userID='LSG';
DELETE FROM usertbl WHERE userID='LSG';

-- 외래키테이블데이타가 없는 경우는 기준테이블의 수정, 삭제 자유롭게 가능
UPDATE usertbl SET userID='ABC', name='홍길동' WHERE userID='KBS';
```

- 기준 테이블 데이타 변경 시 외래 키 테이블도 자동 적용 옵션

```SQL
-- 외래 키 삭제
ALTER TABLE buyTBL
	DROP CONSTRAINT FK_userTBL_buyTBL;
	
-- 외래 키 생성 : 기준 데이타 수정, 삭제 시 외래 키 데이타도 동시에 수정, 삭제됨
ALTER TABLE buyTBL
	ADD CONSTRAINT FK_userTBL_buyTBL
	FOREIGN KEY (userID)
	REFERENCES userTBL(userID)
	ON DELETE CASCADE
	ON UPDATE CASCADE;
	
-- 기준 테이블 수정, 삭제 시 외래키 테이블 데이타도 수정, 삭제됨	
UPDATE usertbl SET userID='ABC' WHERE userID='LSG';
DELETE FROM usertbl WHERE userID='LSG';

select * from usertbl;
select * from buytbl;
```



# [실습 4 : 14 ~ 17p]

### 3) UNIQUE KEY

- PRIMARY KEY와 동일하나 null값 허용
- UNIQUE KEY 생성

```SQL
-- userTBL에 email 컬럼 추가
ALTER TABLE userTBL
	ADD email VARCHAR(50);
	
-- userTBL email 컬럼을 UNIQUE로 변경
ALTER TABLE userTBL
	ADD CONSTRAINT userTBL_ak01
	UNIQUE KEY (email);
```



### 4) CHECK

- 입력되는 데이터를 점검하여 조건에 부합하는 데이타만 저장하도록 제어함

```SQL
-- userTBL의 birthyear 컬럼에 출생연도가 1900년 이후인 데이타만 허용
ALTER TABLE userTBL
	ADD CONSTRAINT ck_birthyear
	CHECK (birthYear >= 1900);

-- birth : 1800 입력시 체크 에러 발생
insert into usertbl values('AAA','gd_Hong','hont@multitest.com', 1800, '010');
	
-- userTBL에 mobile1 컬럼 추가하되
-- mobile1 컬럼 생성 라인에 check문 추가 ('010','011','016','019','017','018','019')
ALTER TABLE userTBL
	ADD mobile1 varchar(3) CHECK (mobile1 IN ('010','011','016','019','017','018','019'));

-- mobile1 : '110' 입력시 체크 에러 발생
insert into usertbl values('AAA','gd_Hong','hont@multitest.com', 1950, '110');	
```



### 5) DEFAULT 정의

* 값 없이 입력 시 자동으로 입력되는 기본값 정의

```SQL
-- userTBL에 mobile1의 기본값을 '010'으로 셋팅
ALTER TABLE userTBL
	ALTER COLUMN mobile1 SET DEFAULT '010';	
	
-- mobile1 기본값 INSERT :  'DEFAULT' 키워드 활용
INSERT INTO userTBL (userID, name, email, birthyear, mobile1)
VALUES('111', 'test1', 'test1@test.com', 2000, DEFAULT);	

-- mobile1 기본값 INSERT :  컬럼명 명시하지 않음
INSERT INTO userTBL (userID, name, email, birthyear)
VALUES('222', 'test2', 'test2@test.com', 2000);

-- 확인
SELECT * FROM userTBL;
```



### 6) NULL 정의

- 컬럼에 NULL 허용여부 셋팅

```SQL
-- userTBL의 name 컬럼에 null값 허용
ALTER TABLE userTBL
	MODIFY COLUMN name VARCHAR(10) NULL;
```



# [실습 5 : 18 ~ 21p]

## 8.1.3 테이블 압축

- ROW_FORMAT=COMPRESSED 옵션 추가

```SQL
CREATE TABLE compressTBL(emp_no int, first_name varchar(14))
 ROW_FORMAT=COMPRESSED;
```



## 8.1.4 임시 테이블

- 터미널, CMD, HeidiSQL 등 접속한 클라이언트 종료 시 삭제됨
- DB 재시작시 삭제됨
- 직접 테이블 DROP시 삭제됨

```SQL
-- temporary table 생성 : userTBL (id varchar(10)), tempTBL (tempid varchar(10))
CREATE TEMPORARY TABLE userTBL (id varchar(10));
CREATE TEMPORARY TABLE tempTBL (tempid varchar(10));

-- 신규 cmd창으로 위 두 개 테이블 확인 : 테이블 없음
desc userTBL;
desc tempTBL;

-- 생성한 cmd 창 exit후 재접속 : 테이블 없음
show talbes;
```



## 8.1.5 테이블 삭제

- 외래키 테이블이 있는 경우 외래키 테이블 삭제후 삭제 가능

```SQL
DROP TABLE userTBL;  -- 외래키 있는 경우 삭제 불가
```



## 8.1.6 테이블 수정

- 이미 생성된 테이블에 무엇인가를 추가/변경/수정/삭제는 모두 ALTER TABLE 사용함

```SQL
-- 1) 열의 추가
ALTER TABLE userTBL
	ADD mobile2 VARCHAR(10) NULL;
	
-- 2) 열의 삭제
ALTER TABLE userTBL
	DROP mobile2;
	
-- 3) 열의 데이터 형식 변경
ALTER TABLE userTBL
	MODIFY name VARCHAR(15) NULL;

-- 4) 열의 이름 및 데이터 형식 변경
ALTER TABLE userTBL
	CHANGE name uName VARCHAR(20) NULL;

-- 5) 열의 제약 조건 추가 및 삭제 : FK_userTBL_buyTBL
ALTER TABLE buytbl
	DROP FOREIGN KEY FK_userTBL_buyTBL

-- 6) 열의 제약 조건 추가 및 삭제 : PRIMARY KEY
ALTER TABLE userTBL
	DROP PRIMARY KEY;
```